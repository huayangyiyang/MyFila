@using FilaShop.Models
@model List<Orders>
@{ 
    Userinfo userinfo = ViewBag.user as Userinfo;

    var stateid = ViewBag.stateid;

    //全部数据多少条
    int allCount = Convert.ToInt32(ViewBag.allCount);
    //每页显示多少条数据
    int pageSize = Convert.ToInt32(ViewBag.pageSize);
    //总共多少页
    int totalpage;
    if (allCount % pageSize == 0)
    {
        totalpage = allCount / pageSize;
    }
    else
    {
        totalpage = allCount / pageSize + 1;
    }

    var currentpage = Convert.ToInt32(ViewBag.currentpage);
}
<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>会员中心</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <link href="~/Content/center/bootstrap.min.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" async="" src="~/scripts/analytics.js"></script>
    <script src="~/scripts/hm.js"></script>
    <script src="~/scripts/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="~/scripts/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
    <script src="~/scripts/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>

    <!--[if lt IE 9]>
    <script src="Scripts/html5fix.js" type="text/javascript" charset="utf-8" ></script>
    <![endif]-->

    <script async="" src="~/scripts/d65868b7da324fdcb8f1f37c02b4b2c4.js"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-111270368-1');
    </script>
    <script src="~/scripts/jquery.icheck.min.js"></script>
    <link rel="stylesheet" href="~/Content/center/theme.css">
    <link rel="stylesheet" href="~/Content/center/global.css">
    <link rel="stylesheet" href="~/Content/center/styles.css">
    <link rel="stylesheet" href="~/Content/center/common_180905.css">
    <script src="~/scripts/jquery.form.js"></script>
    <link rel="stylesheet" href="~/Content/center/flat.css">
    <link rel="stylesheet" type="text/css" href="~/Content/center/bootstrap-datetimepicker.min.css">
    <script type="text/javascript" src="~/scripts/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="~/scripts/bootstrap-datetimepicker.zh-cn.js"></script>
    <script type="text/javascript" src="~/scripts/jquery-3.3.1.js"></script>
    <style>
        .cart-a-img{
            width:15px;
            height:15px;
        }
        .ordernum{
            color:#03234C;
        }
        .ordernum:hover{
            color:blue;
        }
        .pageform{
            margin-left:40%;
            margin:0 auto;
        }
        .page{
             margin:0 auto;
             margin-left:40%;
        }
    </style>
    <script>
        //页面编号
        function page(pageid) {
            $('#_textcurrentpage').val(pageid);
            $('#fomrlist').submit();
        }
    </script>

</head>
<body>
    <form style="visibility:hidden" id="fomrlist" action="~/User/CommandCenter" method="get">
        
        <input type="hidden" id="_textcurrentpage" name="currentpage" value="1" />
        

    </form>


    <header class="fila-header">
        <div class="logo">
            <a href="~/Product/List">
                <img src="~/Images/fila_blue_150.png" alt="">
            </a>
        </div>
        <div class="fila-navbar">
            <div class="navbar-search" style="visibility:hidden;" >
                <input id="key" class="text" type="text" autocomplete="off" value="短袖">
                <button class="button" data-action="/list/?" onclick="location=$(this).attr('data-action')+'&keyword='+$('#key').val(); return false;"></button>
            </div>
            <ul class="navbar-list">
                <!-- 未登录 -->
                @if (userinfo != null)
                {
                    <li class="navbar-user ">
                        <a href="~/User/Detail" target="_blank">
                            您好，
                            <span>@userinfo.Nickname</span>
                        </a>
                    </li>
                    <li class="navbar-logout ">
                        <a href="~/User/LoginOut" title="退出">退出</a>
                    </li>
                    <li>
                        <a class="cart-a-01" href="~/Cart/List"><img class="cart-a-img" src="~/Images/cart-icon.png" /></a>
                        <span class="cart-span-01">@ViewBag.cartcount</span>
                    </li>
                }
                else
                {
                    <li class="navbar-login">
                        <a href="~/User/Login" target="_blank" title="登入">登入</a>
                    </li>
                    <li class="navbar-register">
                        <a href="~/User/Register" target="_blank" title="注册">注册</a>
                    </li>
                    <li>
                        <a class="cart-a-01" href="~/Cart/List"><img class="cart-a-img" src="~/Images/cart-icon.png" /></a>
                        <span class="cart-span-01"></span>
                    </li>
                }


                <li class="navbar-country">
                    <a href="#" target="_blank">
                        <i class="icon icon-country"></i>
                    </a>
                </li>
            </ul>
        </div>
    </header>
    <div class="container main-container main">
        <div class="my-main">
            <div class="row">
                <div class="col-xs-3 my-L">
                    <dl class="my-menu">
                        <dt>
                            会员中心
                        </dt>
                        <dd>
                            <ul class="nav nav-pills nav-stacked">
                                <li data-myaction="orders" class="mm-site_member-orders active">
                                    <a href="~/User/CommandCenter/@userinfo.Id">
                                        <span>全部订单</span>
                                    </a>
                                </li>
                                <li data-myaction="form" class="mm-site_member-form">
                                    <a href="#">
                                        <span>晒单评价</span>
                                    </a>
                                </li>
                                <li data-myaction="order" class="mm-site_member-order">
                                    <a href="#">
                                        <span>售后申请</span>
                                    </a>
                                </li>
                                <li data-myaction="request" class="mm-site_member-request">
                                    <a href="#">
                                        <span>售后处理列表</span>
                                    </a>
                                </li>
                                <li data-myaction="index" class="mm-site_member-index">
                                    <a href="#">
                                        <span>我的预约</span>
                                    </a>
                                </li>
                            </ul>
                        </dd>
                        <dt>
                            账户
                        </dt>
                        <dd>
                            <ul class="nav nav-pills nav-stacked">
                                <li data-myaction="setting" class="mm-site_member-setting">
                                    <a href="~/User/Detail/@userinfo.Id">
                                        <span>会员信息</span>
                                    </a>
                                </li>
                                <li data-myaction="securitycenter" class="mm-site_member-securitycenter">
                                    <a href="#">
                                        <span>账户安全</span>
                                    </a>
                                </li>
                                <li data-myaction="exchange_coupon" class="mm-site_exchange-exchange_coupon">
                                    <a href="#">
                                        <span>积分商城</span>
                                    </a>
                                </li>
                                <li data-myaction="integral" class="mm-site_member-integral">
                                    <a href="#">
                                        <span>我的积分</span>
                                    </a>
                                </li>
                                <li data-myaction="favorite" class="mm-site_member-favorite">
                                    <a href="#">
                                        <span>我的收藏</span>
                                    </a>
                                </li>
                                <li data-myaction="coupon" class="mm-site_member-coupon">
                                    <a href="#">
                                        <span>我的优惠券</span>
                                    </a>
                                </li>
                                <li data-myaction="message" class="mm-site_member-message">
                                    <a href="#">
                                        <span>我的消息</span>
                                    </a>
                                </li>
                                <li data-myaction="index" class="mm-site_member-index">
                                    <a href="#">
                                        <span>增票资质</span>
                                    </a>
                                </li>
                                <li data-myaction="receiver" class="mm-site_member-receiver">
                                    <a href="~/Address/List/@userinfo.Id">
                                        <span>收货地址管理</span>
                                    </a>
                                </li>
                            </ul>
                        </dd>
                    </dl>
                </div>
                <div class="col-xs-9 my-page">
                    <div class="order-wrap">
                        <div class="page-header">
                            <h1>会员信息</h1>
                        </div>
                        <div class="alert alert-warning order-member">
                            <div class="m-baseinfo row">
                                <div class="col-xs-2">
                                    <a href="~/User/Detail/@userinfo.Id">
                                        <img width=77 height=77 class="img-circle" src="~/Images/d2827718db427c364b5d724ece3ecd2b.jpg" alt="17621989302头像" />
                                    </a>
                                </div>
                                <div class="col-xs-6">
                                    <h4>
                                        <a href="~/User/Detail/@userinfo.Id">@userinfo.Nickname</a>
                                        <!--<span class="btn-group">
                                                                    <a class="btn btn-xs btn-default" href="/my-set_pam_uname.html">设置昵称</a>
                                                                </span>-->
                                    </h4>
                                    <ul class="list-inline">
                                        <!-- <li>余额<span class="pl20 pr20">0</span>币</li> -->
                                        <li><span class="pr10"></span>等级：注册会员</li>
                                        <!--<li><span class="label label-warning">注册会员</span></li>
                                        <li><a href="/my-integral.html">积分：0</a></li>
                                                            <li>经验值：0</li>
                                        -->
                                    </ul>
                                </div>
                                <!---->
                            </div>
                        </div>
                        <ul class="nav nav-tabs my-orders-nav">
                            
                            @if (stateid == null)
                            {
                                <li class="orders-state01 active"><a href="~/User/CommandCenter">全部订单</a></li>
                            }else
                            {
                            <li class="orders-state01 "><a href="~/User/CommandCenter">全部订单</a></li>
                            }

                            @if (stateid == 0)
                            {
                                <li class="orders-state01 active"><a href="~/User/CommandCenter?stateid=0">待付款</a></li>
                            }else
                            {
                            <li class="orders-state01"><a href="~/User/CommandCenter?stateid=0">待付款</a></li>
                            }
                                
                                @if (stateid == 1)
                                {
                                    <li class="orders-state01 active"><a href="~/User/CommandCenter?stateid=1">待发货</a></li>
                                }
                                else
                                {
                                    <li class="orders-state01"><a href="~/User/CommandCenter?stateid=1">待发货</a></li>
                                }
                            @if (stateid == 2)
                            {
                                <li class="orders-state01 active"><a href="~/User/CommandCenter?stateid=2">待收货</a></li>
                            }
                            else
                            {
                                <li class="orders-state01"><a href="~/User/CommandCenter?stateid=2">待收货</a></li>
                            }

                                @if (stateid == 3)
                                {
                                    <li class="orders-state01 active"><a href="~/User/CommandCenter?stateid=3">取消</a></li>
                                }
                                else
                                {
                                    <li class="orders-state01"><a href="~/User/CommandCenter?stateid=3">取消</a></li>
                                }

                            @if (stateid == 5)
                            {
                                <li class="orders-state01 active"><a href="~/User/CommandCenter?stateid=5">交易成功，交易关闭</a></li>
                            }
                            else
                            {
                                <li class="orders-state01"><a href="~/User/CommandCenter?stateid=5">交易成功，交易关闭</a></li>
                            }
                                

                            @if (stateid == 4)
                            {
                                <li class="orders-state01 active"><a href="~/User/CommandCenter?stateid=4">退货</a></li>
                            }
                            else
                            {
                                <li class="orders-state01"><a href="~/User/CommandCenter?stateid=4">退货</a></li>
                            }
                                


                               
                            


                        </ul>
                        
                        <div class="my-orders-list">
                        @*第一条订单信息开始*@
                        @foreach (var item in Model)
                        {
                            <table class="table mo-list-head">
                                <thead>
                                    <tr class="text-nowrap">
                                        <th width="67%">
                                            <div class="">
                                                <div class="col-xs-7">
                                                    商品名称
                                                </div>
                                                <!--<div class="col-xs-3 text-left">-->
                                                <!--SKU货号-->
                                                <!--</div>-->
                                                <div class="col-xs-2">
                                                    单价（元）
                                                </div>
                                                <div class="col-xs-1">
                                                    数量
                                                </div>
                                                <div class="col-xs-2">
                                                    商品操作
                                                </div>
                                            </div>
                                        </th>
                                        <th width="15%">
                                            订单金额
                                        </th>
                                        <th width="18%">
                                            交易状态
                                        </th>
                                    </tr>
                                </thead>
                            </table>
                            <div class="row mo-handle">
                                <!--<div class="col-xs-6">
                                    <em>4</em>张订单
                                </div>
                                <div class="col-xs-6 text-right">
                                                </div>-->
                            </div>

                           
                            <table class="table mo-list-items status-active">
                                <thead>
                                    <tr class="text-nowrap">
                                        <th width="67%">
                                            <ul class="list-inline">
                                                <li>创建时间：@item.OrderTime</li>
                                                <li>订单号：<a class="text-muted ordernum" href="~/OrderDetail/Detail?Id=@item.Id"><strong>@item.ordernum</strong></a></li>
                                                
                                                
                                                @switch (item.OrderState)
                                                {
                                                    case 0:
                                                        <li>待付款</li>
                                                        break;
                                                    case 1:
                                                        <li>待发货</li>
                                                        break;
                                                    case 2:
                                                        <li>待收货</li>
                                                        break;
                                                    case 3:
                                                        <li>取消</li>
                                                        break;
                                                    case 4:
                                                        <li>退货</li>
                                                        break;
                                                    case 5:
                                                        <li>交易成功，交易关闭</li>
                                                        break;

                                                }
                                                
                                                <!--  -->
                                            </ul>
                                        </th>
                                        <th width="15%"></th>
                                        <th width="18%"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            @*订单详情表中的循环*@
                                            @for (int i = 0; i < item.OrderDetail.ToList().Count(); i++)
                                            {
                                                var last = "";
                                                if (i == (item.OrderDetail.Count() - 1))
                                                {
                                                    last = "last";
                                                }
                                                else
                                                {
                                                    last = "";
                                                }
                                                        <div class="row mo-item @last">
                                                            <div class="col-xs-2">
                                                                <a href="~/Product/Detail?Productid=@item.OrderDetail.ToList()[i].Goods.Id">
                                                                    <img class="img-thumbnail" 
                                                                         src="~/Images/Product/@item.OrderDetail.ToList()[i].Goods.GoodsImage.FirstOrDefault().BigImage" alt="@item.OrderDetail.ToList()[i].Goods.Name" />
                                                                </a>
                                                            </div>
                                                            <div class="col-xs-5 pl0 pr0">
                                                                <a class="text-muted limit-height" href="~/Product/Detail?Productid=@item.OrderDetail.ToList()[i].Goods.Id">@item.OrderDetail.ToList()[i].Goods.Name<br>
                                                                @item.OrderDetail.ToList()[i].Goods.GoodsColor.Name / @item.OrderDetail.ToList()[i].Goods.GoodsSize.Name
                                                                
                                                                                                        </a>
                                                            </div>
                                                            <!--<div class="col-xs-3">6904527616901</div>-->
                                                            <div class="col-xs-2 text-center">
                                                                <ul class="list-unstyled">
                                                                    <li class="market-price hide"><del>@string.Format("{0:0.00}", item.OrderDetail.ToList()[i].Goods.OldPrice) </del></li>
                                                                    
                                                                    <li class="i-g-price">@string.Format("{0:0.00}", item.OrderDetail.ToList()[i].Goods.NewPrice)</li>
                                                                </ul>
                                                            </div>
                                                            <div class="col-xs-1 text-right">
                                                                @item.OrderDetail.ToList()[i].Number
                                                            </div>
                                                            <div class="col-xs-2 text-center">
                                                            </div>
                                                        </div>
                                            }
                                                        @*订单详情表中的循环*@
</td>
                                        <td class="text-center border-lr" style="padding-top: 54px;">
                                            <small>￥</small>@string.Format("{0:0.00}", item.Price)                           <br>
                                        </td>
                                        <td class="" style="padding-top: 50px;">
                                            @switch (item.OrderState)
                                            {
                                                case 0:
                                                    <span class="btn-status e91010" style="width:auto;text-align: center">待付款</span>
                                                    <a href="~/Orders/OrderDetail?Id=@item.Id" class="btn btn-block btn-danger-pay" style="width:100%;text-align: center">付款</a>
                                            <!-- <a href="/order-cancel-1903060009948.html" class="btn btn-xs btn-block btn-default">订单取消</a> -->
                                                    <input type="hidden" name="name" class="cancelstate" value="@item.Id" />
                                                    <a href="javascript:;" class="btn btn-block btn-default" data-toggle="modal" data-target="#ordercancel1903060009948" style="width:100%;text-align: center">订单取消</a>
                                                    <a href="~/OrderDetail/Detail?Id=@item.Id" class="btn mt5" style="width:100%;text-align: center">订单详情</a>
                                                    break;
                                                case 1:
                                                    <span class="btn-status e91010" style="width:auto;text-align: center">待发货</span>
                                            <!-- <a href="/order-cancel-1903060009948.html" class="btn btn-xs btn-block btn-default">订单取消</a> -->
                                                    <input type="hidden" name="name" class="cancelstate" value="@item.Id" />
                                                    <a href="javascript:;" class="btn btn-block  btn-danger-pay" data-toggle="modal" data-target="#ordercancel1903060009948" style="width:100%;text-align: center">订单取消</a>
                                                    <a href="~/OrderDetail/Detail?Id=@item.Id" class="btn mt5 btn-default" style="width:100%;text-align: center">订单详情</a>
                                                    break;
                                                case 2:
                                                    <span class="btn-status e91010" style="width:auto;text-align: center">待收货</span>
                                            <!-- <a href="/order-cancel-1903060009948.html" class="btn btn-xs btn-block btn-default">订单取消</a> -->
                                                    <input type="hidden" name="name" class="cancelstate" value="@item.Id" />
                                                    <a href="javascript:;" class="btn btn-block  btn-danger-pay" data-toggle="modal" data-target="#ordercancel1903060009948" style="width:100%;text-align: center">订单取消</a>
                                                    <a href="~/OrderDetail/Detail?Id=@item.Id" class="btn mt5 btn-default" style="width:100%;text-align: center">订单详情</a>
                                                    break;
                                                case 3:
                                                    <input type="hidden" name="name" class="cancelstate" value="@item.Id" />
                                                    <span class="btn-status e91010 btn-danger-pay" style="width:auto;text-align: center">订单取消</span>
                                            <!-- <a href="/order-cancel-1903060009948.html" class="btn btn-xs btn-block btn-default">订单取消</a> -->
                                                    
                                                    <a href="~/OrderDetail/Detail?Id=@item.Id" class="btn mt5 btn-default" style="width:100%;text-align: center">订单详情</a>
                                                    break;
                                                case 4:
                                                    <span class="btn-status e91010 btn-danger-pay" style="width:auto;text-align: center">退货中……</span>
                                            <!-- <a href="/order-cancel-1903060009948.html" class="btn btn-xs btn-block btn-default">订单取消</a> -->
                                                    <a href="~/OrderDetail/Detail?Id=@item.Id" class="btn mt5 btn-default" style="width:100%;text-align: center">订单详情</a>
                                                    break;
                                                case 5:

                                                    <span class="btn-status e91010 btn-danger-pay" style="width:auto;text-align: center">交易成功，订单关闭</span>
                                            <!-- <a href="/order-cancel-1903060009948.html" class="btn btn-xs btn-block btn-default">订单取消</a> -->
                                                    <a href="~/OrderDetail/Detail?Id=@item.Id" class="btn mt5 btn-default" style="width:100%;text-align: center">订单详情</a>
                                                    break;

                                            }


                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="modal fade" role="dialog" aria-hidden="false" id="ordercancel1903060009948">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h3 class="modal-title">取消订单 # 1903060009948</h3><span class="e91010">订单取消后不能撤销</span>
                                        </div>
                                        <form method="get" action="/Orders/UpdateState" id='order_edit_form' class="form">
                                            <input type="hidden" name="id" class="form-ordersid-cancel" value="" />
                                            <div class="modal-body">
                                                <div class="row">
                                                    <div class="form-group">
                                                        <label class="col-md-2 control-label">
                                                            取消原因
                                                        </label>
                                                        <div class="col-md-8">
                                                            <select class="form-control" name='memo'>
                                                                <option value='我不想买了'>我不想买了</option>
                                                                <option value='信息填写错误，重新拍'>信息填写错误，重新拍</option>
                                                                <option value='付款遇到问题'>付款遇到问题</option>
                                                                <option value='拍错，重新拍'>拍错，重新拍</option>
                                                                <option value='其他原因'>其他原因</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                <br />
                                            </div>
                                            <div class="modal-footer" style="text-align: center;">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                                <button type="submit" class="btn" style="background-color: #03234c;color: #FFF;">确认取消</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            }
                            <div class="pageform">
                                @*第一条订单信息结束*@
                                <form method="get" id='page' class="page">
                                    <input type="hidden" name="p" value="1">
                                    <ul class="pagination">
                                        <li>

                                            @* <span class="current">@ViewBag.currentpage</span>*@
                                            @if (currentpage != 1)
                                            {
                                                <a class="next" href="javascript:page(@(currentpage-1))">上一页</a>
                                            }


                                            @for (int i = 1; i <= totalpage; i++)
                                            {
                                                if (i == currentpage)
                                                {
                                                    <span class="nocanclick" style="border:none ">@i</span>
                                                }
                                                else
                                                {
                                                    <a class="num" href="javascript:page(@i)">@i</a>
                                                }

                                            }
                                            @if (ViewBag.currentpage != totalpage)
                                            {
                                                <a class="next" href="javascript:page(@(currentpage+1))">下一页</a>
                                            }

                                            <span>共 @totalpage 页</span>
                                            @*
                        <select class="pageSize">
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="50">50</option>

                            </select>
                                            *@
                                        </li>
                                    </ul>
                                </form>
                            </div>
                        </div>
                    </div>
                    <script type="text/javascript">
    $(function(){
        $('.mo-item').each(function() {
            var g_price = new Number($(this).find('.i-g-price').text());
            var m_price = new Number($(this).find('.market-price del').text());
            if((g_price-m_price)<0){
                $(this).find('.market-price').removeClass('hide');
            }
        });
    });

                    </script>
                </div>
            </div>
        </div>
    </div>

    <footer class="fila-footer clearfix">
        <div class="ft-left fl">
            <ul class="link-list">
                <li>
                    <a href="/n-20.html" target="_blank">购物服务</a>
                </li>
                <li>
                    <a href="/history.html" target="_blank">关于品牌</a>
                </li>
                <li>
                    <a href="/shop.html" target="_blank">查找门店</a>
                </li>
            </ul>
            <div class="ft-follow">
                <span>关注FILA的官方媒体:</span>
                <a class="ft-sina" href="http://weibo.com/fila2010?refer_flag=1001030101_" target="_blank"></a>
                <a class="ft-weixin">
                    <div class="ft-weixin-tip">
                        <img src="~/Images/weixin0525.jpg">
                    </div>
                </a>
            </div>
            <div class="ft-service">
                <span>售后服务电话: 400-886-7699</span>
            </div>
        </div>
        <div class="ft-right fr">
            <span>&copy;FILA体育&nbsp;闽ICP备11020421号-8</span>
        </div>
    </footer>
    <div class="fixed-toolbar">
        <a class="fixed-service" onclick="xiaoneng_isExitsFunction();" href="javascript:;">客服</a>
    </div>
    <script src="~/scripts/header_180905.js"></script>
    <script charset="utf-8">
        //订单取消按钮
        $('.btn-default').click(function () {
            $(this).prev('input').val();
            $('.form-ordersid-cancel').val($(this).prev('input').val());
            
        });
        






/*购物数量 事件拦截开始*/

$(function(){
    var change_event_timer = 0;
    var _change_quantity = function(ipt,num){
        ipt = $(ipt),last_val = parseInt(ipt.val());
        var set_v = last_val+num;
        ipt.val(set_v);
        if(isNaN(ipt.val()) || ipt.val()<1){
            ipt.val('1');
        }
        if(ipt.attr('data-max') && set_v>parseInt(ipt.attr('data-max'))){
            ipt.val(ipt.attr('data-max'));
        }
        if(ipt.attr('data-min') && set_v<parseInt(ipt.attr('data-min'))){
            ipt.val(ipt.attr('data-min'));
        }
        if(set_v === parseInt($(ipt).attr('data-now')))return;

        //限购商品限制数量加减
        if($('.order-max').length>0){
            var max_buy = new Number($('.notice-restrict .order-max').text());
            if(set_v >= max_buy){
                ipt.attr('data-now',max_buy);
                ipt.val(max_buy);
            }
        }
        if($('.order-max').length==0&&$('.member-max').length>0){
            var max_buy = new Number($('.notice-restrict .member-max').text());
            if(set_v >= max_buy){
                ipt.attr('data-now',max_buy);
                ipt.val(max_buy);
            }
        }

        //预约商品限制数量加减
        if(!$('.reserve-quantity').hasClass('hide')){
            var $el = $('#J_sale_buy_num');
            var max_sale = $el.data('max-sale');
            if(set_v >= max_sale ){
                ipt.attr('data-now',max_sale);
                ipt.val(max_sale);
            }
        }

        $(ipt).attr('data-now',set_v);
        ipt.trigger('_change',[ipt.val(),num]);
    }

    $(document).on('click','.product-quantity .spinner-buttons',function(e){
        var btn = $(this);
        btn.find('button').eq(0).blur();
        if(btn.data('animating'))return;
        if(btn.next('.spinner-input').length){
            _change_quantity(btn.next('.spinner-input'),-1);
        }
        if(btn.prev('.spinner-input').length){
            _change_quantity(btn.prev('.spinner-input'),+1);
        }
        btn.data('animating',true);
        btn.css('opacity',.2);
        btn.animate({opacity:1},'slow',function(){
            $(this).removeData('animating');
        });


    });
    $(document).on('keyup','.product-quantity .spinner-input',function(e){
        switch (e.keyCode) {
            case 38:
                _change_quantity(this,+1);
                break;
            case 40:
                _change_quantity(this,-1);
                break;
            default:
                _change_quantity(this,0);
        }
    });
});

/*购物数量 事件拦截结束*/
    </script>
    <div style="display:none" data-rel="Baidu Analytics">
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8e1f31faa8383ed7a42a8e58efe4a621";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
        </script>
    </div>
</body>
</html>
